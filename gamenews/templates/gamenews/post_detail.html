{% extends "base.html" %}
{% load static %}

{% block style %}
<link rel="stylesheet" href="{% static 'gamenews/css/post_detail.css' %}">
{% endblock %}

{% block content %}
<div class="container post-wrap">
  <div class="row g-4">

    <div class="col-lg-8">
      <article class="glass p-4">

        <header class="post-header mb-3">
          <h2 class="fw-bold text-light exo">{{ post.title }}</h2>


          <div class="mb-2">
            {% for tag in post.tag.all %}
              <span class="tag"><i class="fa-solid fa-hashtag"></i>{{ tag.title }}</span>
            {% endfor %}
          </div>
        </header>


        {% if post.body_picture %}
          <figure class="mb-3">
            <img src="{{ post.body_picture.url }}" class="img-fluid rounded shadow" alt="{{ post.title }}">
            <figcaption class="text-light small mt-2 text-center">{{ post.title }}</figcaption>
          </figure>
        {% endif %}


        <div class="note-box mb-4">
          <h5 class="exo"><i class="fas fa-info-circle me-2"></i>Краткое описание</h5>
          <p class="mb-0 exo">{{ post.shot_description }}</p>
        </div>


        {% if post.images.all %}
        <section class="post-gallery glass mb-4">

          <div class="viewport js-auto-gallery" data-interval="3000">
            {% for image in post.images.all %}
              <div class="gallery__slide {% if forloop.first %}is-active{% endif %}">
                <a href="{{ image.image.url }}"
                   data-fancybox="post-gallery"
                   data-caption="{{ image.caption|default:post.title }}">
                  <img src="{{ image.image.url }}"
                       alt="{{ image.alt_text|default:post.title }}"
                       loading="lazy">
                </a>
                {% if image.caption %}
                  <div class="gallery__caption exo">{{ image.caption }}</div>
                {% endif %}
              </div>
            {% endfor %}


            <button class="gallery__ctrl gallery__ctrl--prev" type="button" aria-label="Prev">
              <i class="fa-solid fa-chevron-left"></i>
            </button>
            <button class="gallery__ctrl gallery__ctrl--next" type="button" aria-label="Next">
              <i class="fa-solid fa-chevron-right"></i>
            </button>
          </div>


          <div class="thumbs js-thumbs">
            {% for image in post.images.all %}
              <button class="thumb {% if forloop.first %}is-active{% endif %}" type="button" data-index="{{ forloop.counter0 }}">
                <img src="{{ image.image.url }}" alt="thumb-{{ forloop.counter }}">
              </button>
            {% endfor %}
          </div>
        </section>
        {% endif %}


        <div class="article-content exo text-light">
          {{ post.full_description }}
        </div>


        <div class="meta-box mt-3">
          <div>
            <div class="d-flex align-items-center mb-2">
              <span class="exo">Автор:</span>
              <span class="ms-2 exo">{{ post.author.username }}</span>
            </div>
            <div class="d-flex align-items-center">
              <span class="exo">Дата публикации:</span>
              <span class="ms-2 exo">{{ post.published_date }}</span>
            </div>
          </div>
          <div>
            <div class="d-flex align-items-center mb-2">
              <span class="exo">Просмотры:</span>
              <span class="ms-2 exo">{{ post.views }}</span>
            </div>
            <div class="d-flex align-items-center">
              <span class="exo">Категория:</span>
              <a class="tag ms-2 text-decoration-none" href="{% url 'category' post.category.slug %}">{{ post.category.title }}</a>
            </div>
          </div>
        </div>
      </article>


      <section class="glass p-4 mt-4">
        <h3 class="text-warning mb-3 exo">Комментарии ({{ comments.count }})</h3>


        <div class="mb-4">
          <h5 class="text-light exo">Оставить комментарий:</h5>
          <form action="" method="POST">
            {% csrf_token %}
            <div class="mb-3">{{ form.text }}</div>
            <button type="submit" class="search__btn exo"><i class="fas fa-paper-plane me-1"></i>Отправить</button>
          </form>
        </div>


        <div class="comments-list">
          {% for comment in comments %}
            <div class="mb-3 p-3 rounded" style="background:rgba(19,25,34,.55); border:1px solid rgba(255,255,255,.08);">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <strong class="accent">{{ comment.author }}</strong>
              </div>
              <p class="mb-2 text-light exo">{{ comment.text }}</p>
              <p class="mb-0 text-secondary exo">{{ comment.date }}</p>
            </div>
          {% endfor %}
        </div>
      </section>
    </div>


    <div class="col-lg-4">

      <aside class="glass p-4 side-card mb-4">
        <h4 class="text-light exo">Похожие статьи</h4>
        {% for item in rel_posts %}
          <div class="side-item rounded mb-3">
            <div class="row g-0" style="height:130px; overflow:hidden;">
              <div class="col-4">
                <img src="{{ item.anons_picture.url }}" class="img-fluid rounded-start h-100 object-fit-cover" alt="{{ item }}">
              </div>
              <div class="col-8 d-flex align-items-center">
                <div class="p-2">
                  <h6 class="mb-1">
                    <a href="{% url 'post' item.slug %}" class="text-light text-decoration-none exo">{{ item }}</a>
                  </h6>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
        <div class="text-center">
          <a href="#" class="paginator__page">Все статьи</a>
        </div>
      </aside>


      <aside class="glass p-4 side-card mb-4">
        <h4 class="text-light exo">Популярные категории</h4>
        <div class="d-grid gap-2">
          {% for bc in best_cats %}
            <a href="{% url 'category' bc.slug %}" class="btn btn-outline-info btn-sm d-flex justify-content-between align-items-center">
              <span>{{ bc.title }}</span>
              <span class="badge bg-info">{{ bc.total }}</span>
            </a>
          {% endfor %}
        </div>
      </aside>


      <aside class="glass p-4 side-card mb-4">
        <h4 class="text-light exo">Последние новости</h4>
        <div class="list-group list-group-flush">
          {% for p in last_post %}
            <div class="list-group-item bg-transparent border-0 text-light p-2 mb-2 rounded side-item">
              <div class="d-flex w-100 justify-content-between align-items-start">
                <h6 class="mb-1 text-truncate">
                  <a href="{% url 'post' p.slug %}" class="text-light text-decoration-none exo">{{ p.title }}</a>
                </h6>
              </div>
            </div>
          {% endfor %}
        </div>
        <div class="text-center mt-2">
          <a href="#" class="paginator__page">Больше новостей</a>
        </div>
      </aside>


    </div>
  </div>
</div>


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>
<script src="{% static 'js/scripts.js' %}"></script>
{% endblock content %}
